name: macos10.15
on:
  pull_request:
  push:
  schedule:
    - cron: "0 */4 * * *"
jobs:
  test:
    runs-on: macos-10.15
    steps:
      - uses: actions/setup-go@v1
        with:
          go-version: "1.14"
      - uses: actions/checkout@v2
      - run: |
          brew install ooniprobe
          install -d $HOME/.ooni
          touch $HOME/.ooni/initialized
          ooniprobe -P https --bouncer=https://ams-pg.ooni.org -o ./output/https.jsonl \
            web_connectivity -u http://mail.google.com
          ooniprobe -P onion --bouncer=httpo://guegdifjy7bjpequ.onion -o ./output/onion.jsonl \
            web_connectivity -u http://mail.google.com
      - run: go run ./script/postprocess.go
